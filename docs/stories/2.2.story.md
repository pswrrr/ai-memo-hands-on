# Story 2.2: 노트 생성 (제목 + 본문)

## 📋 Status
**Done**

## 🎯 Story

**As a** 로그인한 사용자  
**I want** 새로운 노트를 생성할 수 있도록  
**So that** 아이디어와 메모를 저장할 수 있다

## 📊 Acceptance Criteria

### 기능 요구사항
1. 노트 생성 폼 UI 제공
2. 제목과 본문 입력 필드
3. 노트 저장 기능
4. 입력 유효성 검증
5. 저장 성공/실패 피드백
6. 자동 저장 기능 (선택사항)

### UI/UX 요구사항
1. 직관적인 노트 작성 인터페이스
2. 반응형 디자인 (모바일/데스크톱)
3. 실시간 입력 상태 표시
4. 로딩 상태 및 에러 메시지
5. 저장 완료 확인

### 기술적 요구사항
1. Next.js Server Actions 활용
2. DrizzleORM을 통한 데이터 저장
3. 사용자 인증 상태 확인
4. 입력 데이터 유효성 검증
5. 에러 핸들링 및 사용자 피드백

## 📝 Tasks / Subtasks

- [x] Task 1: 노트 생성 폼 컴포넌트 구현
  - [x] `components/notes/CreateNoteForm.tsx` 생성
  - [x] 제목 입력 필드 구현
  - [x] 본문 입력 필드 구현 (textarea)
  - [x] 폼 상태 관리 (React Hook Form)
  - [x] 입력 유효성 검증

- [x] Task 2: 서버 액션 구현
  - [x] `app/actions/notes.ts` 생성
  - [x] `createNote` 서버 액션 구현
  - [x] 사용자 인증 상태 확인
  - [x] 데이터베이스 저장 로직
  - [x] 에러 핸들링

- [x] Task 3: 데이터 유효성 검증
  - [x] `lib/validations/notes.ts` 생성
  - [x] 노트 생성 스키마 정의
  - [x] Zod를 활용한 유효성 검증
  - [x] 에러 메시지 정의

- [x] Task 4: UI 상태 관리
  - [x] 로딩 상태 표시
  - [x] 성공/실패 피드백
  - [x] 폼 리셋 기능
  - [x] 에러 메시지 표시

- [x] Task 5: 반응형 디자인
  - [x] 모바일 최적화
  - [x] 데스크톱 레이아웃
  - [x] shadcn/ui 컴포넌트 활용
  - [x] 접근성 고려

- [x] Task 6: 자동 저장 기능 (선택사항)
  - [x] 디바운스된 자동 저장
  - [x] 임시 저장 상태 표시
  - [x] 충돌 방지 로직

- [x] Task 7: 단위 테스트 작성
  - [x] 폼 컴포넌트 테스트
  - [x] 서버 액션 테스트
  - [x] 유효성 검증 테스트
  - [x] 에러 처리 테스트

## 🔧 Dev Notes

### Previous Story Insights
Story 2.1에서 구현된 사항:
- DrizzleORM 환경 설정 완료
- 데이터베이스 스키마 정의 완료 (notes, note_tags, summaries 테이블)
- Drizzle 클라이언트 설정 완료
- 마이그레이션 시스템 구축 완료
- Jest 환경 설정 개선

재사용 가능한 컴포넌트 및 함수:
- `lib/db/index.ts` - Drizzle 클라이언트
- `lib/db/schema.ts` - 데이터베이스 스키마
- `lib/validations.ts` - 기존 유효성 검증 함수들
- `contexts/AuthContext.tsx` - 인증 상태 관리
- `hooks/useAuth.ts` - 인증 훅

### Architecture Context

**기술 스택** [Source: docs/architecture.md#1]
- Next.js (App Router, Server Actions)
- shadcn/ui + Tailwind + Radix UI
- Drizzle ORM (마이그레이션/쿼리)
- Supabase (Postgres, Auth, Storage)

**데이터 모델링** [Source: docs/architecture.md#2]
- notes 테이블: id, user_id, title, content, created_at, updated_at
- 사용자-노트 1:N 관계
- UUID 기반 식별자 사용

**서버 액션** [Source: docs/architecture.md#4]
- `saveNote` – 노트 작성/수정
- Next.js Server Actions 기반 데이터 처리
- 사용자 인증 상태 확인 필수

**보안 고려사항** [Source: docs/architecture.md#3]
- 권한 스코프: Notes는 사용자 ID 스코프로 소유자만 CRUD 가능
- Supabase 서비스 롤 키는 서버 전용
- RLS (Row Level Security) 정책 적용

### File Structure
```
app/
├── actions/
│   └── notes.ts                    # 새로 생성: 노트 관련 서버 액션

components/
├── notes/
│   ├── CreateNoteForm.tsx         # 새로 생성: 노트 생성 폼
│   └── NoteEditor.tsx             # 새로 생성: 노트 에디터 컴포넌트

lib/
├── validations/
│   └── notes.ts                   # 새로 생성: 노트 유효성 검증
└── db/
    ├── index.ts                   # 재사용: Drizzle 클라이언트
    └── schema.ts                  # 재사용: 데이터베이스 스키마
```

### API Specifications
- **서버 액션**: `createNote`
  - 입력: `{ title: string, content: string }`
  - 출력: `{ success: boolean, noteId?: string, error?: string }`
  - 인증: 사용자 로그인 상태 확인 필수

- **데이터베이스 쿼리**
  - `db.insert(notes).values({ userId, title, content })`
  - `db.select().from(notes).where(eq(notes.userId, userId))`

### Testing Requirements
**테스트 파일 위치**: `__tests__/`
- `__tests__/CreateNoteForm.test.tsx` - 폼 컴포넌트 테스트 (새로 생성)
- `__tests__/notes-actions.test.ts` - 서버 액션 테스트 (새로 생성)
- `__tests__/notes-validations.test.ts` - 유효성 검증 테스트 (새로 생성)

**테스트 프레임워크**: Jest + Testing Library
- 폼 입력 및 제출 테스트
- 서버 액션 성공/실패 테스트
- 유효성 검증 테스트
- 에러 처리 테스트

**테스트 커버리지 목표**: 100% (Statements, Branches, Functions, Lines)

### Technical Constraints
- 사용자 인증 상태 확인 필수
- 입력 데이터 유효성 검증 필수
- 에러 핸들링 및 사용자 피드백 필수
- 반응형 디자인 필수
- 접근성 고려 필수

### Implementation Notes
1. React Hook Form을 활용한 폼 상태 관리
2. Zod를 활용한 유효성 검증
3. shadcn/ui 컴포넌트 활용
4. Next.js Server Actions 패턴
5. DrizzleORM의 타입 안전성 활용

## 📅 Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Story 2.2 초안 생성 | Bob (Scrum Master) |
| 2025-01-27 | 1.1 | Story 2.2 구현 완료 | James (Full Stack Developer) |

## 🔄 Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
None

### Completion Notes List
- 노트 생성 폼 컴포넌트 구현 완료 (React Hook Form + Zod 유효성 검증)
- 서버 액션 구현 완료 (createNote, updateNote, deleteNote)
- 데이터 유효성 검증 완료 (Zod 스키마, 에러 메시지 정의)
- UI 상태 관리 완료 (로딩, 성공/실패 피드백, 폼 리셋)
- 반응형 디자인 완료 (shadcn/ui 컴포넌트 활용)
- 자동 저장 기능 완료 (디바운스, 임시 저장 상태, 충돌 방지)
- 단위 테스트 작성 완료 (19/19 테스트 통과)
- 대시보드 통합 완료 (노트 생성 링크 추가)

### File List
**새로 생성된 파일:**
- `lib/validations/notes.ts` - 노트 유효성 검증 스키마
- `app/actions/notes.ts` - 노트 관련 서버 액션
- `components/notes/CreateNoteForm.tsx` - 노트 생성 폼 컴포넌트
- `app/dashboard/notes/new/page.tsx` - 새 노트 작성 페이지
- `__tests__/CreateNoteForm.test.tsx` - 폼 컴포넌트 테스트
- `__tests__/notes-actions.test.ts` - 서버 액션 테스트
- `__tests__/notes-validations.test.ts` - 유효성 검증 테스트

**수정된 파일:**
- `app/dashboard/page.tsx` - 노트 생성 링크 추가
- `package.json` - React Hook Form, Zod 의존성 추가

## ✅ QA Results
_To be filled by QA Agent_
