# Story 2.5: 노트 수정 및 실시간 저장

## Status
Done

## Story
**As a** 사용자,
**I want** 기존 노트를 수정하고 실시간으로 자동 저장되도록,
**so that** 노트 내용을 안전하게 업데이트할 수 있다

## Acceptance Criteria
1. 사용자는 노트 상세 페이지에서 수정 버튼을 클릭하여 편집 모드로 전환할 수 있다
2. 편집 모드에서는 제목과 본문을 수정할 수 있다
3. 수정 중인 내용은 3초마다 자동으로 저장된다
4. 자동 저장 상태가 사용자에게 시각적으로 표시된다 (저장 중/저장 완료)
5. 수정 완료 후 저장 버튼을 클릭하여 수동 저장할 수 있다
6. 취소 버튼을 클릭하면 변경사항을 되돌릴 수 있다
7. 제목은 필수 입력이며, 255자를 초과할 수 없다
8. 본문은 10,000자를 초과할 수 없다
9. 수정 완료 후 노트 상세 페이지로 돌아간다
10. 다른 사용자의 노트는 수정할 수 없다
11. 로딩 상태가 표시된다
12. 에러 발생 시 사용자에게 적절한 메시지가 표시된다

## Tasks / Subtasks
- [x] 노트 수정 서버 액션 구현 (AC: 1, 7, 8, 10)
  - [x] updateNote 서버 액션 생성
  - [x] 사용자 권한 검증
  - [x] 데이터 유효성 검증
- [x] 실시간 저장 기능 구현 (AC: 3, 4)
  - [x] 자동 저장 타이머 로직
  - [x] 저장 상태 표시 컴포넌트
  - [x] 중복 저장 방지 로직
- [x] 노트 편집 UI 구현 (AC: 2, 5, 6, 9, 11, 12)
  - [x] NoteEditForm 컴포넌트 생성
  - [x] 편집 모드 토글 기능
  - [x] 폼 유효성 검증
  - [x] 저장/취소 버튼 구현
  - [x] 로딩/에러 상태 처리
- [x] 노트 상세 페이지 업데이트 (AC: 1, 9)
  - [x] 편집 모드 통합
  - [x] 수정 완료 후 리다이렉트
- [x] 테스트 구현 (AC: 1-12)
  - [x] 서버 액션 테스트
  - [x] 자동 저장 로직 테스트
  - [x] 컴포넌트 테스트
  - [x] 권한 검증 테스트

## Dev Notes

### Relevant Source Tree Info
- `app/dashboard/notes/[id]/page.tsx` - 노트 상세 페이지
- `app/actions/notes.ts` - 노트 관련 서버 액션
- `lib/validations/notes.ts` - 노트 유효성 검증 스키마
- `components/notes/` - 노트 관련 컴포넌트들
- `components/ui/` - shadcn/ui 컴포넌트들

### Testing
- **Test file location**: `__tests__/`
- **Test standards**: Jest + Testing Library 사용
- **Testing frameworks**: 
  - Unit tests: Jest
  - Component tests: @testing-library/react
  - Integration tests: Jest
- **Specific testing requirements**:
  - 자동 저장 타이머 로직 테스트
  - 폼 유효성 검증 테스트
  - 권한 검증 테스트
  - 실시간 저장 상태 표시 테스트

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-01-14 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
Claude 3.5 Sonnet (2024-01-14)

### Debug Log References
- Next.js 15의 params 이슈 해결 (await params 적용)
- 자동 저장 훅에서 중복 저장 방지 로직 구현
- 실시간 저장 상태 표시를 위한 시각적 피드백 구현

### Completion Notes List
- **서버 액션 구현**: updateNote 함수에서 사용자 권한 검증과 데이터 유효성 검증을 통합
- **자동 저장 훅**: useAutoSave 커스텀 훅으로 3초마다 자동 저장 및 상태 관리 구현
- **편집 UI**: NoteEditForm 컴포넌트로 제목/본문 수정, 실시간 유효성 검증, 저장 상태 표시
- **상태 관리**: 저장 중/저장 완료/에러 상태를 시각적으로 표시하는 SaveStatusIndicator 컴포넌트
- **편집 모드 통합**: NoteDetail 컴포넌트에 편집 모드 토글 기능 추가
- **테스트 커버리지**: 서버 액션, 자동 저장 로직, 컴포넌트에 대한 포괄적인 테스트 작성

### File List
**생성된 파일:**
- `hooks/useAutoSave.ts` - 자동 저장 커스텀 훅
- `components/notes/SaveStatusIndicator.tsx` - 저장 상태 표시 컴포넌트
- `components/notes/NoteEditForm.tsx` - 노트 편집 폼 컴포넌트
- `components/ui/input.tsx` - Input UI 컴포넌트
- `components/ui/textarea.tsx` - Textarea UI 컴포넌트
- `components/ui/label.tsx` - Label UI 컴포넌트
- `__tests__/update-note.test.ts` - 서버 액션 테스트
- `__tests__/useAutoSave.test.ts` - 자동 저장 훅 테스트
- `__tests__/NoteEditForm.test.tsx` - 편집 폼 컴포넌트 테스트

**수정된 파일:**
- `app/actions/notes.ts` - updateNote 서버 액션 추가
- `components/notes/NoteDetail.tsx` - 편집 모드 토글 기능 추가
- `app/dashboard/notes/[id]/page.tsx` - Next.js 15 params 이슈 수정

## QA Results
*Results from QA Agent review will be added here*
