# Story 1.3: ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •

## ğŸ“‹ Status
**Done**

## ğŸ¯ Story

**As a** ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì–´ë²„ë¦° ì‚¬ìš©ì  
**I want** ì´ë©”ì¼ì„ í†µí•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•  ìˆ˜ ìˆë„ë¡  
**So that** ê³„ì •ì— ë‹¤ì‹œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤

## ğŸ“Š Acceptance Criteria

### ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­
1. ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ í˜ì´ì§€ ì œê³µ
2. ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥ í•„ë“œ ì œê³µ
3. "ì¬ì„¤ì • ë§í¬ ì „ì†¡" ë²„íŠ¼ í´ë¦­ ì‹œ ì´ë©”ì¼ë¡œ ë§í¬ ì „ì†¡
4. ì´ë©”ì¼ ì „ì†¡ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
5. ì¬ì„¤ì • ë§í¬ í´ë¦­ ì‹œ ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í˜ì´ì§€ë¡œ ì´ë™
6. ìƒˆ ë¹„ë°€ë²ˆí˜¸ ë° ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ í•„ë“œ ì œê³µ
7. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„±ê³µ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
8. ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œëœ ë§í¬ì— ëŒ€í•œ ì—ëŸ¬ ì²˜ë¦¬

### UI/UX ìš”êµ¬ì‚¬í•­
1. ê¹”ë”í•˜ê³  ì§ê´€ì í•œ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í¼ ë””ìì¸
2. ì‹¤ì‹œê°„ ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬ í”¼ë“œë°±
3. ë¡œë”© ìƒíƒœ í‘œì‹œ (ì´ë©”ì¼ ì „ì†¡ ì¤‘)
4. ì„±ê³µ/ì‹¤íŒ¨ ìƒíƒœì— ë”°ë¥¸ ì ì ˆí•œ í”¼ë“œë°±
5. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸° ë§í¬ ì œê³µ

### ê¸°ìˆ ì  ìš”êµ¬ì‚¬í•­
1. Supabase Auth API ì—°ë™ (`resetPasswordForEmail`, `updateUser`)
2. Next.js App Router ê¸°ë°˜ êµ¬í˜„
3. ì´ë©”ì¼ í…œí”Œë¦¿ ì„¤ì • (Supabase Dashboard)
4. í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ìœ íš¨ì„± ê²€ì‚¬
5. ë§í¬ ë§Œë£Œ ì‹œê°„ ì²˜ë¦¬ (ê¸°ë³¸ 1ì‹œê°„)
6. ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹…

## ğŸ“ Tasks / Subtasks

- [x] Task 1: ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ í˜ì´ì§€ ë¼ìš°íŠ¸ ì„¤ì • (AC: 1, 2, 5)
  - [x] `/app/auth/reset-password/page.tsx` ìƒì„±
  - [x] ì¸ì¦ ë ˆì´ì•„ì›ƒ ì¬ì‚¬ìš©
  - [x] ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸° ë§í¬ ì¶”ê°€

- [x] Task 2: ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ í¼ êµ¬í˜„ (AC: 2-4)
  - [x] `components/auth/ResetPasswordRequestForm.tsx` ìƒì„±
  - [x] ì´ë©”ì¼ ì…ë ¥ í•„ë“œ êµ¬í˜„
  - [x] "ì¬ì„¤ì • ë§í¬ ì „ì†¡" ë²„íŠ¼ êµ¬í˜„
  - [x] ì´ë©”ì¼ ì „ì†¡ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
  - [x] ë¡œë”© ìƒíƒœ ê´€ë¦¬

- [x] Task 3: ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • í˜ì´ì§€ ë¼ìš°íŠ¸ ì„¤ì • (AC: 5, 6)
  - [x] `/app/auth/update-password/page.tsx` ìƒì„±
  - [x] URL hashì—ì„œ access_token ì¶”ì¶œ
  - [x] í† í° ìœ íš¨ì„± ê²€ì‚¬

- [x] Task 4: ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • í¼ êµ¬í˜„ (AC: 6, 7)
  - [x] `components/auth/UpdatePasswordForm.tsx` ìƒì„±
  - [x] ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œ êµ¬í˜„
  - [x] ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ í•„ë“œ êµ¬í˜„
  - [x] ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¸°ê¸° í† ê¸€
  - [x] ì‹¤ì‹œê°„ ìœ íš¨ì„± ê²€ì‚¬

- [x] Task 5: Supabase Auth ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í•¨ìˆ˜ êµ¬í˜„ (AC: 3, 7, 8)
  - [x] `lib/auth.ts`ì— `resetPassword` í•¨ìˆ˜ ì¶”ê°€
  - [x] `lib/auth.ts`ì— `updatePassword` í•¨ìˆ˜ ì¶”ê°€
  - [x] ì—ëŸ¬ ë©”ì‹œì§€ ë§¤í•‘ (ê¸°ì¡´ getAuthErrorMessage ì¬ì‚¬ìš©)

- [x] Task 6: ì´ë©”ì¼ í…œí”Œë¦¿ ì„¤ì • (AC: 3)
  - [x] redirectTo URLì„ `/auth/update-password`ë¡œ ì„¤ì •
  - [x] Supabaseê°€ ê¸°ë³¸ ì´ë©”ì¼ í…œí”Œë¦¿ ì‚¬ìš©

- [x] Task 7: ì—ëŸ¬ ì²˜ë¦¬ ë° ì‚¬ìš©ì í”¼ë“œë°± (AC: 4, 8)
  - [x] ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ ì²˜ë¦¬ (Supabaseê°€ ë³´ì•ˆìƒ ë™ì¼ ë©”ì‹œì§€ ë°˜í™˜)
  - [x] ë§Œë£Œëœ ë§í¬ ì—ëŸ¬ ì²˜ë¦¬ (URL hash í™•ì¸)
  - [x] ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì²˜ë¦¬
  - [x] ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ

- [x] Task 8: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± (ì™„ë£Œ)
  - [x] ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ í…ŒìŠ¤íŠ¸
  - [x] ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • í…ŒìŠ¤íŠ¸
  - [x] ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
  - [x] lib/auth.ts í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ (resetPassword, updatePassword)
  - [x] ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ (ResetPasswordRequestForm, UpdatePasswordForm)

## ğŸ”§ Dev Notes

### Previous Story Insights
Story 1.1 & 1.2ì—ì„œ êµ¬í˜„ëœ ì‚¬í•­:
- Supabase Auth í´ë¼ì´ì–¸íŠ¸ ì„¤ì • ì™„ë£Œ
- ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ êµ¬í˜„
- ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ êµ¬í˜„
- ì¸ì¦ ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- ì—ëŸ¬ ë©”ì‹œì§€ ë§¤í•‘ í•¨ìˆ˜ êµ¬í˜„

ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸ ë° í•¨ìˆ˜:
- `components/auth/AuthLayout.tsx` - ì¸ì¦ í˜ì´ì§€ ê³µí†µ ë ˆì´ì•„ì›ƒ
- `lib/validations.ts` - ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ í•¨ìˆ˜
- `lib/auth.ts` - Supabase Auth ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
- `app/auth/layout.tsx` - ì¸ì¦ ë¼ìš°íŠ¸ ë ˆì´ì•„ì›ƒ

### Architecture Context

**ê¸°ìˆ  ìŠ¤íƒ** [Source: docs/architecture.md#1]
- Next.js App Router - ì„œë²„ ì»´í¬ë„ŒíŠ¸ ë° Server Actions í™œìš©
- Supabase Auth - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ê¸°ëŠ¥
- shadcn/ui + Tailwind CSS - UI ì»´í¬ë„ŒíŠ¸
- TypeScript - íƒ€ì… ì•ˆì „ì„±

**ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í”Œë¡œìš°** [Source: docs/architecture.md#3]
- Supabase Authì˜ `resetPasswordForEmail` ë©”ì„œë“œ ì‚¬ìš©
- ì´ë©”ì¼ë¡œ ì¬ì„¤ì • ë§í¬ ì „ì†¡
- ë§í¬ í´ë¦­ ì‹œ ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- `updateUser` ë©”ì„œë“œë¡œ ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •

**ë³´ì•ˆ ê³ ë ¤ì‚¬í•­** [Source: docs/architecture.md#3]
- ì¬ì„¤ì • ë§í¬ëŠ” 1ì‹œê°„ í›„ ë§Œë£Œ (Supabase ê¸°ë³¸ê°’)
- í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ì–‘ì¸¡ì—ì„œ ìœ íš¨ì„± ê²€ì‚¬
- ë¹„ë°€ë²ˆí˜¸ëŠ” Supabaseì—ì„œ ì•ˆì „í•˜ê²Œ í•´ì‹œë˜ì–´ ì €ì¥

### File Structure
```
app/
â””â”€â”€ auth/
    â”œâ”€â”€ reset-password/
    â”‚   â””â”€â”€ page.tsx              # ìƒˆë¡œ ìƒì„±: ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ í˜ì´ì§€
    â”œâ”€â”€ update-password/
    â”‚   â””â”€â”€ page.tsx              # ìƒˆë¡œ ìƒì„±: ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • í˜ì´ì§€
    â”œâ”€â”€ login/
    â”‚   â””â”€â”€ page.tsx              # ê¸°ì¡´: ë¡œê·¸ì¸ í˜ì´ì§€
    â””â”€â”€ signup/
        â””â”€â”€ page.tsx              # ê¸°ì¡´: íšŒì›ê°€ì… í˜ì´ì§€

components/
â””â”€â”€ auth/
    â”œâ”€â”€ ResetPasswordRequestForm.tsx  # ìƒˆë¡œ ìƒì„±: ì¬ì„¤ì • ìš”ì²­ í¼
    â”œâ”€â”€ UpdatePasswordForm.tsx        # ìƒˆë¡œ ìƒì„±: ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • í¼
    â”œâ”€â”€ LoginForm.tsx                 # ê¸°ì¡´: ë¡œê·¸ì¸ í¼
    â””â”€â”€ SignupForm.tsx                # ê¸°ì¡´: íšŒì›ê°€ì… í¼

lib/
â”œâ”€â”€ auth.ts                       # ì—…ë°ì´íŠ¸: resetPassword, updatePassword í•¨ìˆ˜ ì¶”ê°€
â”œâ”€â”€ supabase.ts                   # ì¬ì‚¬ìš©: Supabase í´ë¼ì´ì–¸íŠ¸
â””â”€â”€ validations.ts                # ì¬ì‚¬ìš©: í¼ ìœ íš¨ì„± ê²€ì‚¬
```

### API Specifications
- **Supabase Auth API - ì¬ì„¤ì • ìš”ì²­**
  - `supabase.auth.resetPasswordForEmail(email, { redirectTo: string })`
  - ì„±ê³µ ì‹œ ì´ë©”ì¼ë¡œ ì¬ì„¤ì • ë§í¬ ì „ì†¡
  - ì‹¤íŒ¨ ì‹œ error ê°ì²´ ë°˜í™˜

- **Supabase Auth API - ë¹„ë°€ë²ˆí˜¸ ì—…ë°ì´íŠ¸**
  - `supabase.auth.updateUser({ password: newPassword })`
  - ì„±ê³µ ì‹œ user ê°ì²´ ë°˜í™˜
  - ì‹¤íŒ¨ ì‹œ error ê°ì²´ ë°˜í™˜

### Testing Requirements
**í…ŒìŠ¤íŠ¸ íŒŒì¼ ìœ„ì¹˜**: `__tests__/`
- `__tests__/reset-password.test.ts` - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í…ŒìŠ¤íŠ¸ (ìƒˆë¡œ ìƒì„±)

**í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬**: Jest + Testing Library
- ì¬ì„¤ì • ìš”ì²­ í¼ ë Œë”ë§ í…ŒìŠ¤íŠ¸
- ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬ í…ŒìŠ¤íŠ¸
- Supabase Auth ì—°ë™ ëª¨í‚¹ í…ŒìŠ¤íŠ¸
- ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • í…ŒìŠ¤íŠ¸
- ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ**: 100% (Statements, Branches, Functions, Lines)

### Technical Constraints
- ì¬ì„¤ì • ë§í¬ëŠ” ê¸°ë³¸ 1ì‹œê°„ í›„ ë§Œë£Œ
- ì´ë©”ì¼ì€ RFC 5322 í‘œì¤€ ì¤€ìˆ˜
- ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì, ì˜ë¬¸+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì ì¡°í•©
- Supabaseì—ì„œ ì´ë©”ì¼ í…œí”Œë¦¿ ì„¤ì • í•„ìš”

### Implementation Notes
1. `resetPasswordForEmail`ì˜ `redirectTo` íŒŒë¼ë¯¸í„°ë¥¼ `/auth/update-password`ë¡œ ì„¤ì •
2. Supabase Dashboardì—ì„œ ì´ë©”ì¼ í…œí”Œë¦¿ì˜ ì¬ì„¤ì • ë§í¬ URL í™•ì¸ ë° ì„¤ì •
3. `update-password` í˜ì´ì§€ì—ì„œ URL hashì—ì„œ í† í° ì¶”ì¶œ (`#access_token=...`)
4. í† í°ì´ ì—†ê±°ë‚˜ ë§Œë£Œëœ ê²½ìš° ì—ëŸ¬ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
5. Story 1.1, 1.2ì—ì„œ êµ¬í˜„ëœ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜ ì¬ì‚¬ìš©

## ğŸ“… Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | Story 1.3 ì´ˆì•ˆ ìƒì„± | Bob (Scrum Master) |

## ğŸ”„ Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
None

### Completion Notes List
- ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ í˜ì´ì§€ ë° í¼ êµ¬í˜„ ì™„ë£Œ
- ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • í˜ì´ì§€ ë° í¼ êµ¬í˜„ ì™„ë£Œ
- Story 1.1ì—ì„œ êµ¬í˜„ëœ `validateEmail`, `validatePassword`, `validatePasswordMatch` í•¨ìˆ˜ ì¬ì‚¬ìš©
- Story 1.2ì—ì„œ ì‚¬ìš©ëœ ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¸°ê¸° í† ê¸€ íŒ¨í„´ ì¬ì‚¬ìš©
- `lib/auth.ts`ì— `resetPassword` ë° `updatePassword` í•¨ìˆ˜ ì¶”ê°€
- Supabase Authì˜ `resetPasswordForEmail` ë° `updateUser` API ì—°ë™
- URL hashì—ì„œ access_token ì¶”ì¶œ ë° ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ êµ¬í˜„
- ë§Œë£Œëœ ë§í¬ ì²˜ë¦¬ë¥¼ ìœ„í•œ fallback UI êµ¬í˜„
- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„±ê³µ ì‹œ 2ì´ˆ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸
- ìƒì„¸ ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€í•˜ì—¬ ì „ì²´ í”Œë¡œìš° ì¶”ì  ê°€ëŠ¥
- ë³´ì•ˆ: Supabaseê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ì— ëŒ€í•´ì„œë„ ì„±ê³µ ë©”ì‹œì§€ ë°˜í™˜ (ë³´ì•ˆ best practice)
- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì™„ë£Œ**: lib/auth.ts í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ 6ê°œ ëª¨ë‘ í†µê³¼ (100% ì»¤ë²„ë¦¬ì§€)
- **ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ**: ResetPasswordRequestForm, UpdatePasswordForm í…ŒìŠ¤íŠ¸ ì‘ì„±
- **í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**: ì„±ê³µ/ì‹¤íŒ¨/ì˜ˆì™¸ ì²˜ë¦¬ ëª¨ë“  ì¼€ì´ìŠ¤ ì»¤ë²„

### File List
**Created:**
- `app/auth/reset-password/page.tsx` - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ í˜ì´ì§€
- `app/auth/update-password/page.tsx` - ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • í˜ì´ì§€
- `components/auth/ResetPasswordRequestForm.tsx` - ì¬ì„¤ì • ìš”ì²­ í¼ ì»´í¬ë„ŒíŠ¸
- `components/auth/UpdatePasswordForm.tsx` - ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • í¼ ì»´í¬ë„ŒíŠ¸

**Modified:**
- `lib/auth.ts` - `resetPassword` ë° `updatePassword` í•¨ìˆ˜ ì¶”ê°€

**Reused:**
- `lib/validations.ts` - `validateEmail`, `validatePassword`, `validatePasswordMatch` í•¨ìˆ˜ (Story 1.1ì—ì„œ êµ¬í˜„ë¨)
- `lib/auth.ts` - `getAuthErrorMessage` í•¨ìˆ˜ (Story 1.1ì—ì„œ êµ¬í˜„ë¨)
- `app/auth/layout.tsx` - ì¸ì¦ ë¼ìš°íŠ¸ ë ˆì´ì•„ì›ƒ (Story 1.1ì—ì„œ êµ¬í˜„ë¨)

**Test Files Created:**
- `__tests__/auth-functions.test.ts` - lib/auth.ts í•¨ìˆ˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (6ê°œ í…ŒìŠ¤íŠ¸ í†µê³¼)
- `__tests__/ResetPasswordRequestForm.test.tsx` - ì¬ì„¤ì • ìš”ì²­ í¼ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
- `__tests__/UpdatePasswordForm.test.tsx` - ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • í¼ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸

## âœ… QA Results
_To be filled by QA Agent_

