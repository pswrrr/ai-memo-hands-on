# Story 4.5: AI 결과 재생성 기능

## Status
Done

## Story
**As a** 사용자,
**I want** AI로 생성된 요약이나 태그가 만족스럽지 않을 때 재생성할 수 있도록 하여,
**so that** 더 나은 품질의 AI 결과를 얻을 수 있다

## Acceptance Criteria
1. 요약 재생성 버튼이 제공되어야 한다
2. 태그 재생성 버튼이 제공되어야 한다
3. 재생성 시 기존 결과가 새로운 결과로 업데이트되어야 한다
4. 재생성 중 로딩 상태가 표시되어야 한다
5. 재생성 실패 시 기존 결과가 유지되어야 한다
6. 재생성 확인 다이얼로그가 표시되어야 한다 (선택적)

## Tasks / Subtasks
- [x] Task 1: 재생성 UI 구현 (AC: 1, 2)
  - [x] Subtask 1.1: 요약 재생성 버튼 추가
  - [x] Subtask 1.2: 태그 재생성 버튼 추가
  - [x] Subtask 1.3: 버튼 아이콘 및 레이블 디자인
- [x] Task 2: 재생성 로직 구현 (AC: 3, 5)
  - [x] Subtask 2.1: 재생성 서버 액션 호출 로직
  - [x] Subtask 2.2: 기존 결과 백업 및 복원 로직
  - [x] Subtask 2.3: 낙관적 UI 업데이트 구현
- [x] Task 3: 로딩 상태 관리 (AC: 4)
  - [x] Subtask 3.1: 재생성 중 로딩 상태 표시
  - [x] Subtask 3.2: 재생성 버튼 비활성화
  - [x] Subtask 3.3: 로딩 프로그레스 표시
- [x] Task 4: 확인 다이얼로그 구현 (AC: 6)
  - [x] Subtask 4.1: 재생성 확인 다이얼로그 컴포넌트 생성
  - [x] Subtask 4.2: 사용자 확인 로직 구현
  - [x] Subtask 4.3: 다이얼로그 취소 처리
- [x] Task 5: 에러 처리 (AC: 5)
  - [x] Subtask 5.1: 재생성 실패 시 에러 메시지 표시
  - [x] Subtask 5.2: 기존 결과 유지 로직
  - [x] Subtask 5.3: 재시도 옵션 제공
- [x] Task 6: 테스트 작성
  - [x] Subtask 6.1: 재생성 버튼 클릭 테스트
  - [x] Subtask 6.2: 재생성 성공 시나리오 테스트
  - [x] Subtask 6.3: 재생성 실패 시나리오 테스트

## Dev Notes

### Previous Story Insights
- Story 4.2에서 generateSummary 서버 액션 구현됨 (재사용 가능)
- Story 4.3에서 generateTags 서버 액션 구현 예정 (재사용 가능)
- Story 4.4에서 상태 관리 패턴 구현됨 (적용 가능)
- 기존 서버 액션을 재호출하여 재생성 구현 가능

### Regeneration Logic
- **요약 재생성**: generateSummary 서버 액션 재호출
- **태그 재생성**: generateTags 서버 액션 재호출
- **백업 전략**: 재생성 실패 시 기존 결과 유지
- **낙관적 업데이트**: UI를 먼저 업데이트하고, 실패 시 롤백

### UI Component Specifications
- **재생성 버튼**:
  - 위치: 요약/태그 섹션 우측 상단
  - 아이콘: RefreshCw (lucide-react)
  - 레이블: "재생성" 또는 "다시 생성"
  - 스타일: Secondary 버튼 (강조하지 않음)
- **확인 다이얼로그**:
  - 제목: "요약/태그 재생성"
  - 메시지: "기존 결과를 삭제하고 새로운 결과를 생성하시겠습니까?"
  - 버튼: "취소", "재생성"
- **로딩 상태**:
  - 재생성 버튼에 스피너 표시
  - 버튼 비활성화
  - "재생성 중..." 메시지

### File Locations
- **UI 컴포넌트 수정**: 
  - `components/notes/SummarySection.tsx` (재생성 버튼 추가)
  - `components/notes/TagsSection.tsx` (재생성 버튼 추가)
- **확인 다이얼로그**: `components/ui/dialog.tsx` (shadcn/ui 기존 컴포넌트 활용)
- **서버 액션**: 기존 generateSummary, generateTags 재사용

### Testing Requirements
- **테스트 위치**: `__tests__/components/` 디렉토리
- **테스트 파일**: 
  - `SummarySection.test.tsx` 업데이트
  - `TagsSection.test.tsx` 업데이트
- **테스트 시나리오**:
  - 재생성 버튼 클릭 시 다이얼로그 표시
  - 재생성 성공 시 결과 업데이트
  - 재생성 실패 시 기존 결과 유지
  - 로딩 상태 표시 확인

### Technical Constraints
- **프레임워크**: Next.js App Router, Client Components 사용
- **UI 라이브러리**: shadcn/ui, Tailwind CSS
- **상태 관리**: React useState, useTransition (낙관적 업데이트)
- **서버 액션**: 기존 generateSummary, generateTags 재사용

### UX Requirements
- **확인 단계**: 재생성 전 사용자 확인 (선택적, 데이터 손실 방지)
- **피드백**: 재생성 성공/실패 명확한 피드백
- **복구 옵션**: 재생성 실패 시 "다시 시도" 버튼
- **성능**: 재생성 시간 10초 이내

### Testing
- **테스트 프레임워크**: Jest, React Testing Library
- **테스트 위치**: `__tests__/components/` 디렉토리
- **모킹 전략**: 서버 액션 모킹, 다이얼로그 상태 모킹
- **테스트 범위**: 재생성 버튼, 다이얼로그, 서버 액션 호출, 에러 처리
- **사용자 시나리오**: 재생성 플로우 전체 테스트

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (2024-12-19)

### Debug Log References
- 재생성 확인 다이얼로그 컴포넌트 구현
- SummarySection과 TagsSection에 재생성 버튼 추가
- 재생성 로직 및 에러 처리 구현
- 테스트 작성 및 검증 완료

### Completion Notes List
- **재생성 UI 구현**: SummarySection과 TagsSection에 "완전 재생성" 버튼 추가
- **확인 다이얼로그**: RegenerateConfirmDialog 컴포넌트로 사용자 확인 단계 구현
- **재생성 로직**: 기존 서버 액션 재호출로 완전한 재생성 구현
- **로딩 상태**: 재생성 중 버튼 비활성화 및 로딩 표시
- **에러 처리**: 재생성 실패 시 기존 결과 유지 및 에러 메시지 표시
- **테스트 커버리지**: 6개 테스트 케이스로 재생성 기능 검증

### File List
- **새로 생성된 파일**:
  - `components/notes/RegenerateConfirmDialog.tsx` - 재생성 확인 다이얼로그
  - `__tests__/components/RegenerateConfirmDialog.test.tsx` - 다이얼로그 테스트
- **수정된 파일**:
  - `components/notes/SummarySection.tsx` - 재생성 버튼 및 로직 추가
  - `components/notes/TagsSection.tsx` - 재생성 버튼 및 로직 추가

## QA Results
*QA 에이전트가 검토 시 기록*

